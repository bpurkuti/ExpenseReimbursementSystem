<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title>Create Reports</title>
		<meta name="description" content="" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="css/r_checkmark.css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
		<link rel="stylesheet" href="css/view_reports.css" />
		<link rel="stylesheet" href="css/create_reports.css" />
        <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" integrity="undefined" crossorigin="anonymous"> -->
        <script src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>



	</head>
	

	<ul>
		<li class = "liLeft"><a href="view_reports.html">View Reports</a></li>
		<li class = "liLeft"><a href="create_reports.html">Create Reports</a></li>

		<li class = "liRight">
			<button class="btn btn-sm" id = "logout" type="button" onclick="logout()" >
				<span class="glyphicon glyphicon-log-out"></span>
				LogOut
			</button>
		</li>
	</ul>
	<h1 id = "viewReportTitle" ></h1>

	<body>
			<h4 class = "pageTitle">Statistics</h4>
            <div class= "container">
                <canvas id = "myChart"></canvas>
            </div>

		
	</body>
    <script>

    </script>
	<script>
        async function getAllReports(){
			const response = await fetch(`http://localhost:5000/employee/reimbursement`);
			const reports = await response.json();
			let rList = {};
            let rListKeys = []
            let clabels = [];
            let cData = [];
            for(let report of reports){
                rList[`${report.submitterId}`] = new Array();
            }

            for(let report of reports){
                rList[`${report.submitterId}`].push(report.amount);
            }
            console.log(rList);
            rListKeys.push(Object.keys(rList));

            for(let i = 0; i < rListKeys[0].length; i++){
                clabels.push( rListKeys[0][i])
            }
            console.log(clabels);

            for(let i = 0; i < clabels.length; i++){
                let index =  clabels[i];
                let sum = 0;
                for(let j = 0; j<rList[index].length; j++){
                    sum+=rList[index][j];
                }       
                cData.push(sum);
            }
            
            console.log(clabels);
            console.log(cData);



            let myChart = document.getElementById("myChart").getContext("2d");
            const DATA_COUNT = clabels.length;
            const NUMBER_CFG = {count: DATA_COUNT, min: 0, max: 100};
    
            const cdata = {
                labels: clabels,
                datasets: [{
                        label: 'Dataset 1',
                        data: cData,
                        backgroundColor: ['red', 'orange', 'yellow', 'green', 'blue'],
                }]
            };
    
            let massPopChart = new Chart(myChart, {
                type: 'doughnut',
                data: cdata,
                options: {
                    responsive: true,
                    plugins: {
                      legend: {
                        position: 'top',
                      },
                      title: {
                        display: true,
                        text: 'Chart.js Doughnut Chart'
                      }
                    }
                  },
            });
		}

		function logout(){
			window.location.assign("/front_end/login.html");
			return JSON.parse(localStorage.clear());	
		}
        getAllReports()
	</script>
</html>
